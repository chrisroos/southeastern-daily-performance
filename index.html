<!DOCTYPE html>

<html>
  <head>
    <title>Southeastern Daily Performance Querymalarky</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
    
      var FusionApiUrl  = 'http://www.google.com/fusiontables/api/query?sql=';
      var FusionTableID = 359310;
      
      var resetRawQuery = function() {
        $('#rawQuery').val('SELECT * FROM ' + FusionTableID);
      }
    
      $(function() {
        resetRawQuery();
        
        $('#queryReset').click(resetRawQuery);
        
        $('#queryEncoder').click(function() {
          var rawQuery     = $('#rawQuery').val();
          var escapedQuery = encodeURIComponent(rawQuery);
          var url          = FusionApiUrl + escapedQuery;
          
          var anchor = $('<a href="' + url + '" target="_blank">' + url + '</a>');
          $('#escapedQuery').html(anchor);
        });
        
        $('.query').each(function() {
          $(this).click(function() {
            var querystring = this.search;
            var escapedQuery = querystring.split('sql=')[1];
            var unescapedQuery = decodeURIComponent(escapedQuery);
            $('#rawQuery').val(unescapedQuery);
            return false;
          })
        });
        
      })
    </script>
  </head>
  <body>
    <h1>Southeastern Daily Performance Querymalarky</h1>
    
    <h2>Reference</h2>
    <ul>
      <li>
        <a target="_blank" href="http://www.google.com/fusiontables/DataSource?dsrcid=359310">Raw data in the Fusion table</a>
      </li>
      <li>
        <a target="_blank" href="http://code.google.com/apis/fusiontables/docs/developers_reference.html#Select">Fusion table query reference</a>
      </li>
    </ul>
    
    <h2>Example queries</h2>
    <ul>
      <li>
        <a class="query" target="_blank" href="http://www.google.com/fusiontables/api/query?sql=SELECT%20*%20FROM%20359310%20where%20Problem%20LIKE%20'%25Snow%25'">Problems caused by THE SNOW</a>
      </li>
      <li>
        <a class="query" target="_blank" href="http://www.google.com/fusiontables/api/query?sql=SELECT%20'Scheduled%20departure%20station',%20count()%20as%20'number%20of%20problems'%20FROM%20359310%20group%20by%20'Scheduled%20departure%20station'%20order%20by%20count()%20desc">Most problematic stations</a>
      </li>
      <li>
        <a class="query" target="_blank" href="http://www.google.com/fusiontables/api/query?sql=SELECT%20'Scheduled%20departure%20station'%2C%20'Scheduled%20arrival%20station'%2C%20count()%20as%20'Number%20of%20problems'%20FROM%20359310%20group%20by%20'Scheduled%20departure%20station'%2C%20'Scheduled%20arrival%20station'%20order%20by%20count()%20desc">Most problematic routes</a>
      </li>
      <li>
        <a class="query" target="_blank" href="http://www.google.com/fusiontables/api/query?sql=SELECT%20Problem%2C%20count()%20FROM%20359310%20group%20by%20Problem%20order%20by%20count()%20desc">Common problems</a>
      </li>
      <li>
        <a class="query" target="_blank" href="http://www.google.com/fusiontables/api/query?sql=SELECT%20Problem%2C%20count()%20FROM%20359310%20group%20by%20Problem%20order%20by%20Problem%20asc">Alphabetical list of problems</a>
      </li>
    </ul>
    
    <h2>Table columns</h2>
    <p>Date, Problem, Scheduled departure time, Scheduled departure station, Scheduled arrival station, Affect on service</p>
    
    <form>
      <p>
        <textarea id="rawQuery" cols="100" rows="10"></textarea>
      </p>
      <p>
        <input id="queryEncoder" type="button" value="Go go go" />
        <input id="queryReset" type="button" value="Reset" />
      </p>
    </form>
    
    <p id="escapedQuery"></p>
    
  </body>
</html>
